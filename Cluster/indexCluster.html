<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clustering K-Means</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700;800&display=swap');
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background: radial-gradient(circle,rgba(15,24,36,1) 0%,rgba(5,5,5,1) 58%); font-family:'Poppins',sans-serif; color:white; }
    header { text-align:center; padding:20px 0; }
    header p { font-size:30px; font-weight:600; background:linear-gradient(90deg,#fff 0%,#3BA0FF 63%); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .container { width:90%; max-width:700px; margin:50px auto; display:flex; flex-direction:column; align-items:center; }
    .gradient-border { background:linear-gradient(90deg,#fff 0%,#3BA0FF 63%); padding:1px; border-radius:10px; }
    .field { width:500px; height:500px; background:#0a0a0a; border-radius:10px; position:relative; cursor:pointer; }
    .controls { margin-top:20px; display:flex; align-items:center; gap:15px; flex-wrap:wrap; justify-content:center; }
    .btn-main { border:none; background-color:#3BA0FF; color:white; border-radius:5px; width:150px; height:40px; cursor:pointer; transition:all 0.4s; font-size:16px; font-family:'Poppins',sans-serif; }
    .btn-main:hover { color:#202020; font-size:18px; box-shadow:0 0 10px #0F1824FF; }
    .btn-secondary { border:1px solid #a1a1a1; background:transparent; color:white; border-radius:5px; width:40px; height:40px; cursor:pointer; transition:all 0.4s; font-size:20px; font-family:'Poppins',sans-serif; display:flex; align-items:center; justify-content:center; }
    .btn-secondary:hover { font-size:22px; text-shadow:0 0 10px white; box-shadow:0 0 3px white; }
    .custom-input { width:60px; height:40px; background:#0a0a0a; border:1px solid white; border-radius:5px; color:white; text-align:center; font-size:16px; font-family:'Poppins',sans-serif; }
  </style>
</head>
<body>
  <header><p>K-Means clustering</p></header>
  <div class="container">
    <div class="gradient-border mb-3">
      <div class="field" id="plotArea"></div>
    </div>
    <div class="controls">
      <button id="decreaseBtn" class="btn-secondary">−</button>
      <input type="text" id="kCount" class="custom-input" value="3" readonly>
      <button id="increaseBtn" class="btn-secondary">+</button>
      <button id="clusterBtn" class="btn-main">Cluster</button>
      <button id="clearBtn" class="btn-main" style="background:transparent; border:1px solid white; color:white; width:150px;">Clear</button>
    </div>
  </div>

  <script>
    const plotArea = document.getElementById('plotArea');
    let points = [];

    function drawPoint(p, color='white') {
      const dot = document.createElement('div');
      dot.style.position = 'absolute';
      dot.style.width = '14px';
      dot.style.height = '14px';
      dot.style.borderRadius = '50%';
      dot.style.background = color;
      dot.style.left = (p.x - 7) + 'px';
      dot.style.top = (p.y - 7) + 'px';
      plotArea.appendChild(dot);
    }

    plotArea.addEventListener('click', (e) => {
      const r = plotArea.getBoundingClientRect();
      const x = e.clientX - r.left;
      const y = e.clientY - r.top;
      points.push({ x, y });
      drawPoint({ x, y });
    });

    document.getElementById('decreaseBtn').addEventListener('click', () => {
      const input = document.getElementById('kCount');
      let v = Math.max(1, parseInt(input.value) - 1);
      input.value = v;
    });
    document.getElementById('increaseBtn').addEventListener('click', () => {
      const input = document.getElementById('kCount');
      let v = parseInt(input.value) + 1;
      input.value = v;
    });

    document.getElementById('clearBtn').addEventListener('click', () => {
      points = [];
      plotArea.innerHTML = '';
    });

    document.getElementById('clusterBtn').addEventListener('click', () => {
      const k = Math.max(1, parseInt(document.getElementById('kCount').value));
      fetch('http://algorithms.test/algorithms/cluster/cluster.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ k, points })
      })
      .then(res => res.json())
      .then(json => {
        plotArea.innerHTML = '';
        const colors = ['#3BA0FF','#FF8C00','#8A2BE2','#00FA9A','#FFD700','#FF1493'];
        json.clusters.forEach((cluster, idx) => {
          const color = colors[idx % colors.length];
          cluster.forEach(p => drawPoint(p, color));
        });
      })
      .catch(err => console.error('Ошибка:', err));
    });
  </script>
</body>
</html>
